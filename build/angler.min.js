/* Copyright 2016 Tobias Schwinger.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(function(){'use strict';function v(a){var e=new Float32Array(9);a&&(e[0]=e[4]=e[8]=a);return e}function w(a,e,b){for(var g=0;3!==g;++g)for(var c=3*g,d=0;9!==d;d+=3)a[d+g]=e[c]*b[d]+e[c+1]*b[d+1]+e[c+2]*b[d+2];return a}function B(a,e,b,g,c){for(var d=0;3!==d;++d)for(var k=3*d,f=0;9!==f;f+=3){for(var m=0,h=0;3!==h;++h)var q=f+h,u=k+h,m=m+(e[q]*b[u]+g[q]*c[u]);a[f+d]=m}return a};function C(){this.l=v(1);this.i=v(1);this.j=v(1);this.v=v(1);this.A=v(1);this.B=v();this.w=v();this.m=!0;this.s=v(1);this.u=v(1);this.D=v();this.C=v()};function D(a,e){var b=a.b;if(void 0!==b){var g=a.a.length/(a.c||1);if(0!==g%1)throw Error("sampleData.length is not a multiple of sampleSize");if(!Array.isArray(b)){for(var c=b.start,d=b.step,b=Array(g),k=0;k!==g;++k)b[k]=c+k*d;e.push({a:a.a,c:a.c,b:b});return}if(b.length!==g)throw Error("sampleDomain.length does not match the number of samples");}e.push(a)}function G(a){var e=[];if(Array.isArray(a))for(var b=0,g=a.length;b!==g;++b)D(a[b],e);else D(a,e);return e}
function H(a){for(var e=[],b=0,g=a.length;b!==g;++b){var c=a[b],d=c.c||1;if(1<d){for(var k=c.a,f=Array(d),m=k.length/d,h=0;h!==d;++h)f[h]=new Float32Array(m);for(h=0;h!==m;++h)for(var q=0;q!==d;++q)f[q][h]=k[h*d+q];for(k=0;k!==d;++k)e.push({b:c.b,a:f[k],c:1})}else e.push(c)}return e}function I(a,e,b){return function(g){for(var c=0,d=0,k=a.length;d!==k;++d)var f=a[d],m=(g-f.f)*(g<f.f?f.h:f.d),c=c+f.g*Math.exp(-.5*m*m);return e[b]=c}}
function J(a,e,b){function g(a){a*=d;for(var c=0;c!==d;++c)e[c+b]=k[a+c];return 1!==d?e:e[0]}var c=a.b,d=a.c||1,k=a.a,f=0,m=-0,h=-0,q=0,u=0;return function(a){var b=f,l=c[b],n=c[b-1];a:{b:{c:{d:if(!(a<l)){for(var r=b+2;;){if(void 0===l){if(a<n)break d;f=b=c.length;return g(b-1)}if(b===r)break;n=l;l=c[++b];if(a<l)break b}n=c.length;break c}if(a>=n)break a;else{l=c[1];a<l&&(b=2,n=l);for(r=b-2;;){if(void 0===n)return f=0,g(0);if(b===r)break;l=n;n=c[--b-1];if(a>=n)break b}n=b;b=0}}for(;b<n;)l=b+n>>>1,
a<c[l]?n=l:b=l+1;l=c[b];n=c[b-1];if(void 0===n)return f=0,g(0);if(void 0===l)return f=b=c.length,g(b-1)}f=b;var r=b-2,p=b+1,t=c[r],z=c[p];void 0===t&&(r=b,t=2*n-l);void 0===z&&(p=b,z=2*l-n);var A=.5*(l-n);m=A/(n-t);h=A/(z-l);q=r*d;u=p*d}b*=d;r=b-d;l=(a-n)/(l-n);p=l*l;t=p*l;a=-m*t+2*m*p-m*l;n=(1+m)*t+(-1.5-2*m)*p+(-.5+m)*l+1;l=(-1-h)*t+(1.5+h)*p+.5*l;p=h*t-h*p;for(t=0;t!==d;++t)e[t]=a*k[q+t]+n*k[r+t]+l*k[b+t]+p*k[u+t];return 1!==d?e:e[0]}}
function K(a,e){for(var b=a.length,g=Array(b),c=0,d=0;d!==b;++d){var k=a[d],f=void 0!==k.c?k.c:1,m=e||new Float32Array(f),h=0;void 0!==e&&(h=c,c+=f);f=k.o;g[d]=void 0!==f?I(f,m,h):J(k,m,h)}return g}function L(a){a=G(a);for(var e=0,b=0,g=a.length;b!==g;++b)e+=a[b].c||1;var c=new Float32Array(e),d=K(a,c);return 1===d.length?d[0]:function(a){for(var b=0,e=d.length;b!==e;++b)d[b](a);return 1!==c.length?c:c[0]}};var M={b:{start:400,step:25},c:3,a:[0,0,.03,.36,-.02,.6,.58,-.005,1,.3,.1,.6,.1,.4,.4,.2,.86,.64,.47,1,.78,.82,.8,.76,1,.43,.6,.72,.17,.3,.28,.04,.1,.07,.005,.01,.01,0,0]};var N={b:[560,570,580,590,600,610,620,630,640,650,660,700],a:[0,0,.02,.075,.25,.46,.65,.73,.77,.8,.82,.84]},O={b:[400,460,500,515,520,540,550,560,570,580,590,600,685,690,700],a:[.25,.67,.77,.7,.67,.45,.33,.18,.08,.03,0,0,0,0,.02]};function P(a,e,b){return function(g){return a[e](g)*a[b](g)}}
function Q(){this.spectrumFilterR=this.spectrumFilterL=this.spectrumDisplay=this.colorSpace=null;var a=new C;this.j=a;this.encoderL=a.s;this.encoderR=a.u;this.filterOpacity=this.filterBalance=0;this.hueImportance=1;this.separationR=this.separationL=0;this.colorization=1;this.colorFusion=this.hueOverdrive=.2;this.duboisNormalization=this.colorSpaceIsXYZ=!1;this.l=a=Array(12);this.m=new Float32Array(36);v();for(var e=0;3!==e;++e)a[3+e]=P(a,0+e,9),a[6+e]=P(a,0+e,10);a[11]=P(a,9,10)}
Q.prototype.i=function(){for(var a=this.l,e=this.spectrumDisplay||L(M),b=0;3!==b;++b)a[0+b]=e[b];a[9]=this.spectrumFilterL||L(N);a[10]=this.spectrumFilterR||L(O);for(var e=this.m,b=this.colorSpace||L(M),g=a.length,c=3*g,d=e||new Float32Array(c),k=0;k!==c;++k)d[k]=0;for(c=401.25;700>c;c+=2.5)for(var k=b(c),f=0;f!==g;++f)for(var m=3*f,h=a[f](c),q=0;3!==q;++q)d[m+q]+=h*k[q];a=e[1];a=1/a;for(b=0;27!==b;++b)e[b]*=a;g=1.4*this.filterBalance;a=Math.pow(.33,this.filterOpacity-1);b=(2+g)*a;g=(2-g)*a;d=this.colorSpaceIsXYZ;
for(f=h=k=c=0;3!==f;++f)var m=e[27+f],q=e[30+f],u=e[33+f],c=c+m*m,k=k+q*q,h=h+u*u;var c=1/Math.sqrt(c),k=1/Math.sqrt(k),f=this.separationL,m=this.separationR,h=.25/h,f=f*Math.abs(f)*h,m=m*Math.abs(m)*h,h=this.hueImportance,q=.125*this.colorization/(a*a),u=.2*this.colorFusion,x=this.hueOverdrive,y=1-x;d&&(h=.99*h+.01,h*=h);for(var a=this.j,l=0;3!==l;++l)for(var n=0;3!==n;++n){var r=3*l+n;a.l[r]=e[0+r];a.i[r]=e[9+r]*b;a.j[r]=e[18+r]*g;var p=e[27+n]*c,t=e[27+l]*c,z=e[30+n]*k,A=e[30+l]*k,E=u,F=u;n==l&&
(d?E=F=1!==n?h:1:(E=t*h+.7*(1-h),F=A*h+.7*(1-h)));p*=b;t*=b;z*=g;A*=g;E-=q*(y*p+x*z)*A;F-=q*(y*z+x*p)*t;a.v[r]=E;a.A[r]=F;p=-e[33+n]*e[33+l];a.B[r]=f*p;a.w[r]=m*p}a.m=this.duboisNormalization;g=a.l;d=a.i;c=a.j;e=a.s;b=a.u;d=B(a.D,B(e,d,a.v,c,a.w),d,B(b,d,a.B,c,a.A),c);c=d[0];k=d[1];f=d[2];m=d[3];h=d[4];q=d[5];u=d[6];x=d[7];y=d[8];l=y*h-q*x;n=q*u-y*m;r=x*m-h*u;p=c*l+k*n+f*r;if(0===p)throw Error("can't invert singular matrix");p=1/p;d[0]=p*l;d[1]=p*(f*x-y*k);d[2]=p*(q*k-f*h);d[3]=p*n;d[4]=p*(y*c-f*
u);d[5]=p*(f*m-q*c);d[6]=p*r;d[7]=p*(k*u-x*c);d[8]=p*(h*c-k*m);w(e,d,w(a.C,e,g));w(b,d,w(a.C,b,g));if(a.m){for(c=d=g=a=0;9!==c;c+=3)a+=e[c]+b[c],g+=e[c+1]+b[c+1],d+=e[c+2]+b[c+2];for(c=0;9!==c;c+=3)e[c]/=a,b[c]/=a,e[c+1]/=g,b[c+1]/=g,e[c+2]/=d,b[c+2]/=d}};window.angler={ColorSpaces:{XYZ_CIE31:L([{o:[{g:.362,f:442,h:.0624,d:.0374},{g:1.056,f:599.8,h:.0264,d:.0323},{g:-.065,f:501.1,h:.049,d:.0382}]},{o:[{g:.821,f:568.8,h:.0213,d:.0247},{g:.286,f:530.9,h:.0613,d:.0322}]},{o:[{g:1.217,f:437,h:.0845,d:.0278},{g:.681,f:459,h:.0385,d:.0725}]}]),RGB_Marguier06_A:L(M),RGB_Marguier06_B:L({b:{start:400,step:25},c:3,a:[0,0,0,.17,.05,.55,.23,.13,1,.03,.22,.58,-.15,.42,.22,-.2,.89,.22,.13,.98,.26,.6,.67,.27,1,.2,.23,.72,-.034,.12,.28,-.03,.04,.07,-.01,.01,0,0,0]})},
Displays:{LCD:K(H(G([{b:[570,572,577,581,585,587,591,594,597,602,604,606,607.5,608.5,613,619,626,629,631,632,645,649,652,658,660,662,663,665,670,677,682,684,688,690,695,698,700],a:[0,0,.02,.02,.13,.06,.08,.01,.04,.01,.02,.06,.15,.89,.18,.12,.04,.12,.03,.02,.01,.03,.01,.01,.017,.01,.01,.015,.01,.014,.008,.014,.006,.007,.02,.006,0]},{b:[432,433,434,434.5,435,435.5,436,443,444,445,446,447,448,449,450,451,452,453,454,465,468,480,486,490,497,500,520,529,535,536,539,540,542,542.5,543,543.2,544,544.5,545.5,
547,548,552,552.8,555,559,560,574,574.5,575,576,577,578,581,583,584,586,590,591,595,599,600,601,602,607,608,610,611,613,617,620,622,624,625,629,630,631,635,650,700],a:[0,0,.01,.025,.025,0,0,0,0,.01,0,0,0,0,.01,.005,.015,0,0,0,0,.035,.125,.122,.075,.04,.008,.01,.028,.04,.18,.3,.83,1,.8,.73,.73,.94,.94,.29,.22,.12,.09,.03,.005,.005,.005,.005,.01,.06,.03,.09,.055,.09,.055,.09,.035,.04,.01,.015,.005,.01,.006,.004,.008,.085,.085,.028,.005,.007,.01,.005,.005,.005,.008,.005,.005,.005,.006]},{b:[400,401,
405,406,408,415,430,432,432.5,433,434,435,436,436.5,437,440,450,470,478,480,486,488,490,494,496,498,500,501,520,535,537,539,540,544,545,546,553,560,580,583,584,585,586,590,592.5,593.5,594.5,595.5,604,609,610,611,612,620],a:[0,0,.02,.01,.002,.001,.055,.065,.08,.3,.62,.8,.5,.11,.09,.1,.13,.09,.06,.06,.15,.15,.12,.06,.05,.05,.014,.014,.007,.01,.01,.02,.07,.07,.04,.03,.002,0,0,0,.003,0,0,0,0,.002,0,0,0,0,.002,0,0,0]}]))),LED_Projector_A:K(H(G([{b:[420,600,620,638,639,640,658,678,858],a:[0,0,.1,.98,.99,
.98,.1,0,0]},{b:[316,496,516,534,535,536,554,574,698],a:[0,0,.1,.74,.75,.74,.1,0,0]},{b:[240,423,445,458,459,460,473,497,622],a:[0,0,.1,.93,.94,.93,.1,0,0]}]))),LED_Projector_B:K(H(G([{b:[411,580,603,627,630,631,649,669,793],a:[0,0,.1,.98,.99,.98,.1,0,0]},{b:[346,470,487,521,525,529,580,605,628],a:[0,0,.1,.97,.98,.97,.1,0,0]},{b:[240,420,432,457,460,463,490,500,622],a:[0,0,.1,.97,.98,.97,.1,0,0]}])))},Filters3D:{Red:L(N),Cyan:L(O),Magenta:L({b:[400,420,440,460,470,480,490,500,570,580,590,600,610,
620,660,700],a:[.43,.42,.38,.17,.08,.026,0,0,0,0,.05,.28,.65,.77,.86,.87]}),Green:L({b:[470,480,490,500,520,525,532,560,570,580,590,600],a:[0,0,.02,.12,.34,.35,.34,.11,.05,.02,0,0]}),Blue:L({b:[400,443,460,470,490,530,535,650,660,670,685,700],a:[.08,.41,.33,.22,.08,0,0,0,0,.01,.03,.12]}),Yellow:L({b:[470,480,490,535,565,590,600,620,650,680,700],a:[0,0,.01,.046,.028,.1,.11,.1,.145,.094,.32]})},MatrixController:Q};var R=Q.prototype;R.update=R.i;})();

